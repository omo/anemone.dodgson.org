+++
tags  = ["review"]
title = "Book: Kotlin in Action"
date  = "2017-02-27 11:54:42"
+++
<p><a href="https://www.manning.com/books/kotlin-in-action">Kotlin in Action</a> を読んだ。けっこうよかった。</p><p>Kotlin はさして難しい言語ではなくオンラインの資料もあるので、本を読まずに適当にサンプルとかを真似ながらでも割と使える。なのでひやかし目的なら本はいらないと思う。Scala をやったことがあれば特に。</p><p>自分は育児の気晴らしで小さいアプリを Kotlin を使って書いている。そういう風に実際に使うとなるともう少し深く理解して損はなかろうと読んだ。その期待には答えてくれた。この本は丁寧に書かれているし、Kotlin の中の人が書いており authoritative という意味でも安心。1.1  の内容も少しだけ触れている。ただ async/await はでてこない.</p><p><hr /></p><p>Kotlin それ自体について。</p><p>モダン言語を一通りひやかした人にとって新しく学べる概念などはまったくない。だいたい Scala の無難でオーバーヘッドの少ないところだけ持ってきたようなデザインだから、サーバ側でわざわざ Kotlin を使うメリットは感じない。一方で Android プログラミングにおける Java の残念さをだいぶ打ち消してくれるので Android プログラマ的にはキラー言語だと思う。Kotlin の開発陣も Android での用途を重く見ているのは各所から感じる。</p><p>一通りチュートリアルを冷やかしただけだと気づかない面白い機能、いちばんは inline まわり。</p><p>まず inline function に渡した lambda の中で return すると、lambda  ではなく外側の inline function から return できる。まじで？おかげで inline function を制御構造に使う柔軟さが増す。Python にあった <a href="https://docs.python.org/2/library/exceptions.html#exceptions.StopIteration">StopIteration</a> を throw するダサさがない。でもちょっと狂ってるよな。</p><p>Inline function の <a href="https://github.com/JetBrains/kotlin/blob/master/spec-docs/reified-type-parameters.md">reified type</a>. Java の generics は type erasure で実行時には型が消えてしまうのだけれど、inline function では型の中身に依存できる。たとえば generic class を new できる。まじで？たしかに便利で、ライブラリたちも reified type に大きく依存している。</p><p>Outer return にしろ reified type にしろ、Kotlin の inline function は C++ のような単なる高速化のヒントではなく異なる機能を持っている。ちょっとぎょっとするけれど、便利でもある。</p><p>そのほか面白かったのは Java クラス相手の nullable の扱い。Nullable の概念がない Java からきた API は引数も戻り値も全て nullable にするのが理論的には正しい。ただ実用的にはかったるすぎるので、それらは <a href="https://kotlinlang.org/docs/reference/java-interop.html#null-safety-and-platform-types">platform types</a> という特別な型になる。Platform types は Kotlin 側では Nullable としても Non-nullable としても宣言できる。 けっこう大胆な判断だけれど、まあ悪くない感じ。</p><p>個人的には nullable type はあってもなくてもいいと思っているけれど、Null handling まわりの頑張りで便利になってるのも事実だから嫌いではない。CoffeeScript 由来の <a href="https://kotlinlang.org/docs/reference/null-safety.html#safe-calls">safe call</a> とか、ふつうにいい。</p><p>あとは細かいけど <a href="https://kotlinlang.org/docs/reference/lambdas.html#function-literals-with-receiver">lambda に receiver を渡せる</a>のも気の利いた syntax sugar だと思う。</p><p>全体的に無茶せずバランス重視でストレスのない言語だよ Kotlin. Java 混ぜるのも簡単だし、もう余暇アプリはぜんぶこれでいいわ。新しく学ぶ概念がないのは少し退屈だけれど、それは他でやります。</p>
